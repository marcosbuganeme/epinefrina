<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html lang="pt" 
	xmlns:o="http://omnifaces.org/ui"
	xmlns:p="http://primefaces.org/ui"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:sec="http://www.springframework.org/security/tags">

	<ui:composition template="/WEB-INF/decorador/layout-autenticado.xhtml">
		<ui:define name="conteudo">
			<sec:authorize ifAllGranted="EMPRESA">
				<div class="agenda">
					<div id="wrapper">
						<ui:include src="/pages/auth/empresa/sidebar.xhtml" />

						<div style="margin-top: 2% !important;" />
						<p:messages closable="true" />

						<h:form id="frm-agenda" prependId="false">
							<div id="page-content-wrapper">
								<div class="container-fluid">
									<a href="#menu-toggle" id="menu-toggle">
										<img alt="Botão para minimizar a aba de utilidades do sistema" 
											class="logo" 
											jsf:library="img" 
											jsf:name="bt_toggle.png" />
									</a>


									<div class="col-md-8">
										<div class="panel panel-default">
											<div class="panel-body">
												<p:pickList id="secretarias" 
													disabled="#{manterAgendaBean.form.desabilitaPicklistSecretaria}"
													effect="bounce"
					                				filterMatchMode="contains"
													value="#{manterAgendaBean.form.modelSecretarias}" 
													var="secretaria"
													itemValue="#{secretaria}" 
													itemLabel="#{secretaria.nome}" 
													responsive="true"
													showCheckbox="true" 
					                				showSourceFilter="true" 
					                				showTargetFilter="true">

											        <f:facet name="sourceCaption">Secretárias disponíveis</f:facet>
											        <f:facet name="targetCaption">Secretárias selecionadas</f:facet>

													<o:converter 
														converterId="omnifaces.ListConverter" 
														list="#{manterAgendaBean.form.secretarias}" />

													<p:column>
														<p>
												            <h6>Nome: #{secretaria.nome}</h6>
											            	<h6>Login: #{secretaria.usuario.login}</h6>
											        	</p>
													</p:column>
											    </p:pickList>
											</div><!-- panel-body -->
										</div><!-- panel -->
									</div><!-- col-md-8 -->

									<div class="col-md-4">
										<div class="panel panel-default">
											<div class="panel-body">
												<div class="col-md-12">
													<h:inputText id="titulo" 
														class="form-control"
														pt:placeholder="Título da agenda" 
														style="width: 100% !important; margin-top: 2% !important;"
														type="text"
														value="#{manterAgendaBean.form.agenda.titulo}" />
												</div>

												<div class="col-md-12">
													<h:selectOneMenu 
														id="categoria" 
														converter="omnifaces.SelectItemsConverter"
														style="margin-top: 2% !important;"
														styleClass="form-control" 
														value="#{manterAgendaBean.form.agenda.especialidade.categoria}">

														<f:selectItem 
															itemLabel="Qual categoria?"
															noSelectionOption="true" />

														<f:selectItems 
															var="categoria" 
															itemLabel="#{categoria.nome}" 
															itemValue="#{categoria}" 
															value="#{manterAgendaBean.form.categorias}" />

														<p:ajax 
															listener="#{manterAgendaBean.preparaExamesRelacionados()}" 
															update="especialidade valor-exame" />
													</h:selectOneMenu>
												</div>

												<div class="col-md-12">
													<p:selectOneMenu 
														id="especialidade" 
														converter="omnifaces.SelectItemsConverter" 
														disabled="#{manterAgendaBean.form.desabilitaComboboxEspecialidade}"
														filter="true"
														style="width: 100% !important; margin-top: 2% !important;" 
														value="#{manterAgendaBean.form.agenda.especialidade}">

														<f:selectItem 
															itemLabel="Qual especialidade?"
															noSelectionOption="true" />

														<f:selectItems 
															var="especialidade" 
															itemLabel="#{especialidade.nome}"
															itemValue="#{especialidade}" 
															value="#{manterAgendaBean.form.especialidades}" />
													</p:selectOneMenu>
												</div>

												<p:outputPanel id="valor-exame">
													<div class="col-md-12">
														<h:inputText 
															class="form-control" 
															id="valor" 
															style="width: 100% !important; margin-top: 2% !important;"
															value="#{manterAgendaBean.form.agenda.valor}" 
															disabled="#{manterAgendaBean.form.habilitaValor}"
															pt:placeholder="valor" />
													</div>
												</p:outputPanel>
											</div><!-- panel-body -->
										</div><!-- panel -->
									</div><!-- col-md-4 -->

									<div class="col-md-12">
								        <p:schedule 
								        	id="atividade" 
								        	value="#{manterAgendaBean.form.scheduleModel}" 
								        	widgetVar="widgetAtividade" 
								        	timeZone="GMT-3">
								            <p:ajax 
								            	event="dateSelect" 
								            	listener="#{manterAgendaBean.selecionaPorData}" 
								            	oncomplete="PF('atividadeDialog').show();" 
								            	update="frm-detalhes-atividade" />

								            <p:ajax 
								            	event="eventSelect" 
								            	listener="#{manterAgendaBean.selecionaPorAtividade}" 
								            	oncomplete="PF('atividadeDialog').show();" 
								            	update="frm-detalhes-atividade" />

								            <p:ajax 
								            	event="eventMove" 
								            	listener="#{manterAgendaBean.onEventMove}" />

								            <p:ajax 
								            	event="eventResize" 
								            	listener="#{manterAgendaBean.onEventResize}" />
								        </p:schedule>
									</div>

									<div class="col-md-12">
										<h:commandLink 
											action="#{manterAgendaBean.salvar()}"
											id="btn-agenda">
											<img 
												alt="Botão que finaliza a criação da agenda" 
												data-toggle="tooltip" 
												data-placement="bottom" 
												jsf:library="img" 
												jsf:name="bt-salvar.png"
												title="Clique para criar uma agenda"
												style="margin-top: 2%" />
										</h:commandLink>
									</div>
								</div><!-- container fluid / conteúdo -->		
							</div><!-- /#page-content-wrapper -->
						</h:form>
					</div>
				</div>

				<h:form id="frm-detalhes-atividade" prependId="false">
				    <p:dialog 
				    	widgetVar="atividadeDialog" 
				    	header="Atividade da agenda" 
				    	showEffect="clip" 
				    	hideEffect="clip">

				        <h:panelGrid columns="2">
				            <p:outputLabel 
				            	for="descricao" value="Descrição: " />
				            <p:inputTextarea
				            	id="descricao" 
				            	value="#{manterAgendaBean.form.scheduleEvent.description}"
				            	placeholder="Anotações importantes referentes ao exame" />

				            <p:outputLabel 
				            	for="horario" 
				            	value="Horário da consulta: " />
				            <p:calendar 
				            	id="horario" 
				            	value="#{manterAgendaBean.form.scheduleEvent.startDate}" 
				            	timeZone="GMT-3" 
				            	placeholder="dia/mês/ano"
				            	pattern="dd/MM/yyyy HH:mm"/>

				            <p:commandLink
				            	actionListener="#{manterAgendaBean.adicionaAtividade}" 
				            	id="btn-adicionar" 
				            	oncomplete="PF('widgetAtividade').update(); PF('atividadeDialog').hide();"
				            	update="atividade">
								<img alt="Botão que cadastra uma agenda" 
									data-toggle="tooltip" 
									data-placement="bottom" 
									jsf:library="img" 
									jsf:name="bt-salvar.png"
									title="Clique para cadastrar a atividade"
									style="margin-top: 2%" />
			            	</p:commandLink>
				        </h:panelGrid>
				    </p:dialog>
				</h:form>
			</sec:authorize>
		</ui:define>

		<ui:define name="personalizar-script">
			<script jsf:library="js" jsf:name="schedule-primefaces.js" />
		</ui:define>
	</ui:composition>
</html>