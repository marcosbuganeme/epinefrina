<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html
	lang="pt" 
	xmlns:p="http://primefaces.org/ui"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

	<head jsf:id="head">
		<title>Encaixe-me</title>

		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link jsf:library="css" jsf:name="bootstrap.min.css" type="text/css" />

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	    <![endif]-->

		<link jsf:library="webjars" jsf:name="font-awesome/4.6.3/css/font-awesome-jsf.css" type="text/css" />
		<link jsf:library="css" jsf:name="padrao/style.css" rel="stylesheet" type="text/css" />
		<link jsf:library="css" jsf:name="padrao/customizacao.css" rel="stylesheet" type="text/css" />
		<link jsf:library="css" jsf:name="normalize.css" rel="stylesheet" type="text/css" />
	</head>

	<body class="container-fluid results" jsf:id="body">
		<f:metadata>
			<f:viewParam name="qualquercoisa" />
			<f:event listener="#{buscaOfertaBean.validaUrl()}" type="preRenderView" />
		</f:metadata>

		<div class="pre-header">
			<div class="col-md-3" />
			<div class="col-md-9" />
		</div>

		<header class="row">
			<div class="col-md-3">
				<nav class="menu"></nav>
			</div>

			<div class="col-md-6 marca">
				<img alt="Logo marca do encaixe-me" class="logo" jsf:library="img" jsf:name="logo_encaixe-me.png" />
			</div>

			<div class="col-md-3">
				<div class="side-menu">
					<a jsf:outcome="/pages/public/cadastro/assistido">
						<div class="cadastrar">
							<h3>cadastrar</h3>
						</div>
					</a>

					<a jsf:outcome="/pages/public/login">
						<div class="login">
							<h3>login</h3>
						</div>
					</a>
				</div>
			</div>
		</header>

		<section class="row info-pag">
			<form class="form-results" jsf:id="frm-filtro" jsf:prependId="false">
				<div class="col-md-10">
					<div class="col-md-4">
						<h:selectOneMenu id="categoria" 
							converter="omnifaces.SelectItemsConverter" 
							styleClass="form-control" 
							value="#{buscaOfertaBean.form.filtro.categoria}">
							<f:selectItem 
								itemLabel="Qual categoria?"
								noSelectionOption="true" />
							<f:selectItems 
								itemLabel="#{categoria.nome}" 
								itemValue="#{categoria}" 
								var="categoria" 
								value="#{buscaOfertaBean.form.categorias}" />
							<p:ajax 
								listener="#{buscaOfertaBean.preparaExamesRelacionados()}" 
								update="especialidade corpo" />
						</h:selectOneMenu>
					</div>

					<div class="col-md-4">
						<p:selectOneMenu id="especialidade" 
							converter="omnifaces.SelectItemsConverter" 
							disabled="#{buscaOfertaBean.form.desabilitaComboboxEspecialidade}"
							filter="true" styleClass="combo100"
							value="#{buscaOfertaBean.form.filtro.especialidade}">
							<f:selectItem 
								itemLabel="Qual especialidade?"
								noSelectionOption="true" />
							<f:selectItems 
								itemLabel="#{especialidade.nome}"
								itemValue="#{especialidade}" 
								var="especialidade" 
								value="#{buscaOfertaBean.form.especialidades}" />
							<p:ajax 
								listener="#{buscaOfertaBean.preparaPartesDoCorpoRelacionadas()}" 
								update="corpo" />
						</p:selectOneMenu>
					</div>

					<div class="col-md-4">
						<h:selectOneMenu id="corpo" 
							converter="omnifaces.SelectItemsConverter"
							disabled="#{!buscaOfertaBean.form.desabilitaComboboxCorpo}"
							styleClass="form-control"
							value="#{buscaOfertaBean.form.filtro.corpo}">
							<f:selectItem 
								itemLabel="-- partes do corpo --"
								noSelectionOption="true" />
							<f:selectItems 
								itemLabel="#{corpo.nome} #{corpo.complemento}"
								itemValue="#{corpo}" 
								var="corpo" 
								value="#{buscaOfertaBean.form.corpos}" />
						</h:selectOneMenu>
					</div>

					<div class="col-md-4">
						<p:selectOneMenu id="plano" 
							converter="omnifaces.SelectItemsConverter" filter="true"
							styleClass="combo100"
							value="#{buscaOfertaBean.form.filtro.planoSaude}">
							<f:selectItem 
								itemLabel="Qualquer plano de saúde" />
							<f:selectItems 
								itemLabel="#{plano.nome}"
								itemValue="#{plano}" var="plano" 
								value="#{buscaOfertaBean.form.planos}" />
						</p:selectOneMenu>
					</div>

					<div class="col-md-4">
						<h:selectOneMenu id="periodo" 
							converter="omnifaces.GenericEnumConverter" 
							styleClass="form-control"
							value="#{buscaOfertaBean.form.filtro.periodo}">
							<f:selectItem 
								itemLabel="Qualquer periodo do dia" />
							<f:selectItems 
								itemLabel="#{periodo.descricao}"
								itemValue="#{periodo}" var="periodo" 
								value="#{buscaOfertaBean.form.periodos}" />
						</h:selectOneMenu>
					</div>

					<div class="col-md-4">
						<h:selectOneMenu id="semana" 
							converter="omnifaces.GenericEnumConverter" 
							styleClass="form-control"
							value="#{buscaOfertaBean.form.filtro.semana}">
							<f:selectItem 
								itemLabel="Qualquer dia da semana" />
							<f:selectItems 
								itemLabel="#{semana.descricao}"
								itemValue="#{semana}" var="semana" 
								value="#{buscaOfertaBean.form.semanas}" />
						</h:selectOneMenu>
					</div>
				</div>

				<div class="col-md-2">
					<p:commandLink id="btn-pesquisar-novamente"
						action="#{buscaOfertaBean.pesquisar()}">
						<img alt="Botão para pesquisar encaixes de acordo com os filtros selecionados" 
							jsf:library="img" 
							jsf:name="bt_encaixe-me.png"
							title="Clique para pesquisar" />
					</p:commandLink>
				</div>
			</form>
		</section>

		<section class="row">
			<p:outputPanel autoUpdate="true" rendered="#{buscaOfertaBean.form.breadcrumb.isEmpty()}">
				<ol class="breadcrumb">
					<ui:repeat var="descricao" value="#{buscaOfertaBean.preparaBreadCrumb()}">
						<li>
							<a>#{descricao}</a>
						</li>
					</ui:repeat>
				</ol>
			</p:outputPanel>
		</section>

		<form jsf:id="frm-resultado" jsf:prependId="false">
			<p:outputPanel autoUpdate="true"> 
				<p:messages />

				<div jsf:rendered="#{!buscaOfertaBean.form.agendas.isEmpty()}">
					<ui:repeat var="agenda" value="#{buscaOfertaBean.form.agendas}">
						<div class="col-md-6 box-results">
							<div class="detail-date">
								<img alt="Imagem em miniatura do estabelecimento de saúde"
									jsf:library="img" jsf:name="logo-detail.jpg" />

								<div class="date">
									<h1>
										<h:outputText value="#{agenda.horario}">
											<f:convertDateTime locale="pt" pattern="dd" />
										</h:outputText>
									</h1>

									<h2>
										<h:outputText value="#{agenda.horario}">
											<f:convertDateTime locale="pt" pattern="MMMM" />
										</h:outputText>
									</h2>

									<h3>
										<h:outputText value="#{agenda.horario}">
											<f:convertDateTime locale="pt" pattern="YYYY" />
										</h:outputText>
									</h3>
								</div>
							</div>

							<div class="detail-info">
								<div class="info-title">
									<div class="title">
										<h3>#{agenda.titulo}</h3>
									</div>
									<div class="hour-agenda">
										<h4>
											às
											<h:outputText value="#{agenda.horario}">
												<f:convertDateTime locale="pt" pattern="HH:mm" />
											</h:outputText>
										</h4>
									</div>
								</div>

								<div class="barra" />

								<div class="info-detail">
									<div class="left">
										<h3 class="estab">#{agenda.razaoSocial}</h3>

										<p class="desc">
											<span>descrição:</span> #{agenda.descricao}
										</p>

										<p class="end">
											<span>endereço:</span> serviço não implementado
										</p>
									</div>

									<div class="right">
										<p:commandLink
											actionListener="#{convenioBean.formataPlanoConvenioPorEmpresa(agenda.idEmpresa)}"
											oncomplete="PF('dlgPlanosSaude').show();"
											update="panel-dialog-planos" value="Ver planos">
										</p:commandLink>

										<div class="valor" jsf:rendered="#{buscaOfertaBean.isCategoriaExame()}">
											<i class="fa fa-money" aria-hidden="true" />
											<h5>
												R$
												<h:outputText value="#{agenda.valor}">
													<f:convertNumber currencySymbol="R$" locale="pt_BR" minFractionDigits="2" />
												</h:outputText>
											</h5>
											<p>aproximadamente</p>
										</div>

										<div class="bt-ok">
											<p:commandLink oncomplete="PF('dlgLogin').show();" 
												update="panel-dialog-login">
												<h2>ok</h2>
											</p:commandLink>
										</div>
									</div> <!-- right -->
								</div> <!-- info-detail -->
							</div> <!-- detail-info -->
						</div> <!-- col-md-6 box-results -->
					</ui:repeat>
				</div>
			</p:outputPanel>
		</form>

		<p:outputPanel id="panel-dialog-planos">
			<form jsf:id="frm-dialog-planos" jsf:prependId="false">
				<p:dialog id="dialog-planos" draggable="false"
					header="Planos suportados" modal="true" widgetVar="dlgPlanosSaude"
					resizable="false" responsive="true">
					<h4 class="plano-saude">#{convenioBean.form.convenios}</h4>
				</p:dialog>
			</form>
		</p:outputPanel>

		<p:outputPanel id="panel-dialog-login">
			<form jsf:id="frm-dialog-login" jsf:prependId="false">
				<p:dialog id="dialog-login" draggable="false" 
					header="Faça login" modal="true" widgetVar="dlgLogin"
					resizable="false" responsive="true">
					<h4>É necessário se cadastrar no sistema para realizar agendamentos</h4>
					<br />
					<a id="btn-abre-cadastro" 
						jsf:action="#{buscaOfertaBean.abreCadastro()}">
						<span>clique aqui</span>
					</a>
				</p:dialog>
			</form>
		</p:outputPanel>

		<h:outputScript library="primefaces" name="jquery/jquery.js" />
		<script jsf:library="js" jsf:name="bootstrap.min.js" type="text/javascript" />
		<script jsf:library="js" jsf:name="jquery.fancybox.js" type="text/css" />
	</body>
</html>